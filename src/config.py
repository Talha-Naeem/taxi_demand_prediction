# src/config.py
import os
from dotenv import load_dotenv
from src.paths import PARENT_DIR
from typing import Optional, List
from src.feature_metadata import FeatureGroupConfig, FeatureViewConfig
from pathlib import Path

# Base data directory
DATA_DIR = Path("data")  # You can change this to your preferred path
DATA_DIR.mkdir(parents=True, exist_ok=True)  # Ensure it exists
# ---- Predictions Path ----
PREDICTIONS_PATH = str(DATA_DIR / "predictions.csv")

# Load env vars
load_dotenv(PARENT_DIR / ".env")

try:
    HOPSWORKS_PROJECT_NAME = os.environ["HOPSWORKS_PROJECT_NAME"]
    HOPSWORKS_API_KEY = os.environ["HOPSWORKS_API_KEY"]
except KeyError:
    raise Exception(
        "Create an .env file at the project root with HOPSWORKS_PROJECT_NAME and HOPSWORKS_API_KEY"
    )

# ---- Feature Data (historical rides time-series) ----
FEATURE_GROUP_METADATA = FeatureGroupConfig(
    name="time_series_hourly_feature_group",
    version=1,
    description="Feature group with hourly time-series data of historical taxi rides",
    primary_key=["pickup_location_id", "pickup_ts"],
    event_time="pickup_ts",
    online_enabled=True,
)

FEATURE_VIEW_METADATA = FeatureViewConfig(
    name="time_series_hourly_feature_view",
    version=1,
    feature_group=FEATURE_GROUP_METADATA,
)

# ---- Predictions ----
FEATURE_GROUP_PREDICTIONS_METADATA = FeatureGroupConfig(
    name="model_predictions_feature_group",
    version=1,
    description="Predictions generated by the production model",
    primary_key=["pickup_location_id", "pickup_hour"],
    event_time="pickup_hour",
    online_enabled=False,
)

# FEATURE_VIEW_PREDICTIONS_METADATA = FeatureViewConfig(
#     name="model_predictions_feature_view",
#     version=1,
#     feature_group=FEATURE_GROUP_PREDICTIONS_METADATA,
# )

# # ---- Monitoring ----
# MONITORING_FV_NAME = "monitoring_feature_view"
# MONITORING_FV_VERSION = 1

# ---- Monitoring ----
FEATURE_GROUP_MONITORING_METADATA = FeatureGroupConfig(
    name="monitoring_metrics",
    version=1,
    description="Monitoring metrics for taxi demand prediction (MAE by hour and location)",
    primary_key=["pickup_hour", "level", "pickup_location_id"],
    event_time="pickup_hour",
    online_enabled=False,
)

MONITORING_FV_NAME = "monitoring_feature_view"
MONITORING_FV_VERSION = 1


# ---- Model ----
MODEL_NAME = "taxi_demand_predictor_next_hour"
MODEL_VERSION = 1

# ---- Training / Inference ----
N_FEATURES = 653
N_HYPERPARAMETER_SEARCH_TRIALS = 1
MAX_MAE = 30.0
